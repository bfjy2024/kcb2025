<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024-2025-2课程表</title>
    <style>
        :root {
            --class1: #e8f4ff; --class2: #f0f8ff;
            --class3: #f5f3ff; --class4: #fff0f5;
            --active-week: #007AFF;
        }

        body {
            font-family: -apple-system, system-ui;
            background: #f5f5f7;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        //下面为节假日新增
        .holiday-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 235, 238, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #d32f2f;
            pointer-events: none;
        }
        
        td {
            position: relative;
            min-height: 80px;
        }
        
        .course-content {
            position: relative;
            z-index: 1;
        }
        
        .holiday-tag {
            color: #d32f2f;
            font-size: 12px;
            margin-top: 4px;
        }
        .week-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .week-nav button {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #e3e3e8;
            background: white;
            cursor: pointer;
            transition: 0.2s;
        }

        .week-nav button.active {
            background: var(--active-week);
            color: white;
            border-color: var(--active-week);
        }

        .week-card {
            background: white;
            border-radius: 18px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            padding: 20px;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 500;
        }

        .current-course {
            background: #fff8e1 !important;
            box-shadow: inset 0 0 0 2px #ffd54f;
        }

        .time-col {
            width: 100px;
            font-weight: 500;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="week-nav" id="weekNav"></div>
    <div id="timetables"></div>

<script>
// 基础数据
const startDate = new Date(2025, 1, 24); // 2025-02-24
const holidays = [
    { name: '清明节', date: '2025-04-04', duration: 3 },
    { name: '劳动节', date: '2025-05-01', duration: 5 },
    { name: '端午节', date: '2025-05-31', duration: 3 },
    { name: '中秋节', date: '2025-09-06', duration: 3 },
    { name: '国庆节', date: '2025-10-01', duration: 7 }
];
const courses = [
    { // 星期一
        name: '高数', weeks: '2-16双', time: '1-2', day: 1,
        classroom: '3-608', class: '网安3', color: 'var(--class1)'
    },
    { // 星期一
        name: '数模', weeks: '1-16', time: '7-8', day: 1,
        classroom: 'L6-909', class: '软件3', color: 'var(--class3)'
    },
    { // 星期一晚上
        name: '高数', weeks: '1-16', time: '9-10', day: 1,
        classroom: '5-604', class: '网络2', color: 'var(--class2)'
    },
    { // 星期三
        name: '高数', weeks: '1-16', time: '1-2', day: 3,
        classroom: '3-602', class: '网安3', color: 'var(--class1)'
    },
    { // 星期五
        name: '数模', weeks: '1-16', time: '1-2', day: 5,
        classroom: 'L6-902', class: '软件3', color: 'var(--class3)'
    },
    { // 星期五下午
        name: '高数', weeks: '1-15单', time: '5-6', day: 5,
        classroom: '3-309', class: '网络2', color: 'var(--class2)'
    },
    { // 星期四
        name: '高数', weeks: '1-17无9', time: '7-8', day: 4,
        classroom: '1-408', class: '电气5', color: 'var(--class4)'
    },
    { // 星期二晚上
        name: '高数', weeks: '1-17无9', time: '9-10', day: 2,
        classroom: '2-306', class: '电气5', color: 'var(--class4)'
    }
];

// 初始化课程表
function init() {
    // 生成周导航
    const nav = document.getElementById('weekNav');
    for (let week = 1; week <= 17; week++) {
        const btn = document.createElement('button');
        btn.textContent = `第${week}周`;
        btn.onclick = () => showWeek(week);
        nav.appendChild(btn);
    }

    // 生成所有周课表
    const container = document.getElementById('timetables');
    for (let week = 1; week <= 17; week++) {
        const card = document.createElement('div');
        card.className = 'week-card';
        card.id = `week${week}`;
        card.innerHTML = `
            <h3>第 ${week} 周（${getDateRange(week)}）</h3>
            ${renderTable(week)}
        `;
        container.appendChild(card);
    }

    // 显示当前周
    showWeek(getCurrentWeek());
    setInterval(highlightCurrent, 60000);
    highlightCurrent();
}

// 显示指定周
function showWeek(week) {
    // 更新导航按钮
    document.querySelectorAll('.week-nav button').forEach(btn => {
        btn.classList.toggle('active', btn.textContent === `第${week}周`);
    });

    // 显示对应周课表
    document.querySelectorAll('.week-card').forEach(card => {
        card.style.display = card.id === `week${week}` ? 'block' : 'none';
    });
}

// 渲染课程表
function renderTable(week) {
    const timeSlots = [
        { time: '1-2', period: '上午' },
        { time: '5-6', period: '下午' },
        { time: '7-8', period: '下午' },
        { time: '9-10', period: '晚上' }
    ];

    let html = `<table>
        <tr>
            <th class="time-col">时间</th>
            ${[1,2,3,4,5].map(d => {
                const dateStr = getDateStr(week, d);
                const holiday = getHolidayInfo(dateStr);
                return `
                    <th>星期${['一','二','三','四','五'][d-1]}<br>
                    <small>${dateStr}</small>
                    ${holiday ? `<div class="holiday-tag">${holiday}</div>` : ''}
                    </th>
                `;
            }).join('')}
        </tr>`;

    timeSlots.forEach(slot => {
        html += `<tr>
            <td class="time-col">${slot.time}节<br>${slot.period}</td>
            ${[1,2,3,4,5].map(day => {
                const dateStr = getDateStr(week, day);
                const course = courses.find(c => 
                    checkWeek(week, c.weeks) && 
                    c.day === day && 
                    c.time === slot.time
                );
                const cellContent = course ? `
                    <div class="course-content">
                        <b>${course.name}</b><br>
                        ${course.classroom}<br>
                        ${course.class}
                    </div>
                ` : '';
                
                const holiday = getHolidayInfo(dateStr);
                const holidayOverlay = holiday ? `
                    <div class="holiday-overlay">
                        ${holiday}
                    </div>
                ` : '';

                return `
                    <td style="background:${course?.color || 'transparent'}">
                        ${cellContent}
                        ${holidayOverlay}
                    </td>
                `;
            }).join('')}
        </tr>`;
    });

    return html + '</table>';
}
// 辅助函数
function checkWeek(current, condition) {
    if (condition.includes('无')) {
        const [range, exclude] = condition.split('无');
        const [start, end] = range.split('-').map(Number);
        return current >= start && current <= end && current != exclude;
    }
    if (condition.includes('双')) {
        const [start, end] = condition.replace('双','').split('-').map(Number);
        return current >= start && current <= end && current % 2 === 0;
    }
    if (condition.includes('单')) {
        const [start, end] = condition.replace('单','').split('-').map(Number);
        return current >= start && current <= end && current % 2 !== 0;
    }
    const [start, end] = condition.split('-').map(Number);
    return current >= start && current <= end;
}

function getCurrentWeek() {
    const now = new Date();
    const diff = Math.floor((now - startDate) / (1000*60*60*24*7));
    return Math.max(1, Math.min(17, diff + 1));
}

function getDateStr(week, day) {
    const date = new Date(startDate);
    date.setDate(date.getDate() + (week-1)*7 + day-1);
    return `${date.getMonth()+1}/${date.getDate()}`;
}

function getDateRange(week) {
    const start = new Date(startDate);
    start.setDate(start.getDate() + (week-1)*7);
    const end = new Date(start);
    end.setDate(start.getDate()+4);
    return `${start.getMonth()+1}/${start.getDate()} - ${end.getMonth()+1}/${end.getDate()}`;
}
//下面函数为节假日新增
function getHolidayInfo(dateStr) {
    const [month, day] = dateStr.split('/');
    const date = `2025-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
    
    for (const h of holidays) {
        const start = new Date(h.date);
        const end = new Date(start);
        end.setDate(start.getDate() + h.duration - 1);
        const current = new Date(date);
        if (current >= start && current <= end) {
            return h.name;
        }
    }
    return null;
}

function isHoliday(dateStr) {
    return getHolidayInfo(dateStr) !== null;
}
function highlightCurrent() {
    const now = new Date();
    const currentWeek = getCurrentWeek();
    const currentDay = now.getDay(); // 0=周日
    
    // 清除旧高亮
    document.querySelectorAll('.current-course').forEach(el => {
        el.classList.remove('current-course');
    });

    // 如果是周末或非教学日
    if (currentDay === 0 || currentDay === 6) return;

    // 匹配当前时间段
    const hours = now.getHours();
    let timeSlot = '';
    if (hours >= 8 && hours < 10) timeSlot = '1-2';
    else if (hours >= 14 && hours < 16) timeSlot = '5-6';
    else if (hours >= 16 && hours < 18) timeSlot = '7-8';
    else if (hours >= 19 && hours < 21) timeSlot = '9-10';

    if (timeSlot) {
        const table = document.querySelector(`#week${currentWeek} table`);
        if (table) {
            const cell = table.querySelector(
                `tr:has(td:contains("${timeSlot}节")) ~ tr td:nth-child(${currentDay})`
            );
            if (cell) cell.classList.add('current-course');
        }
    }
}

// 启动程序
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
